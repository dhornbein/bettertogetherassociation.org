<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-96951579-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-96951579-3');
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://cdn.rawgit.com/jgthms/minireset.css/master/minireset.css">
    <title>Resources: Denver Freelancers</title>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico"/>
    <link rel="stylesheet" href="css/resources.css">
  </head>
  <body>
    <nav><small><a href="/">Home</a></small></nav>
    <h1>Resources</h1>
    <p>
      Check out these books, websites, promo codes, and tools recomended by other freelancers.
    </p>
    <p class="hug note">
      * Some of the websites and books use affiliate links to help raise money, you can support this project by clicking the links! Also, content on this page is publically editable, if you see something amiss please <a href="mailto:hello@denverfreelancing.com">email us</a>
    </p>
    <div id="main">
      <div class="resources">
        <h2 id="books">ðŸ“– Books</h2>
        <div class="books" v-if="books">
          <div class="book"
               :href="book.link"
               v-for="book in books">
            <a :href="book.link" class="cover">
              <img :src="book.cover" :alt="book.title" v-if="book.cover">
            </a>
            <p>
              <strong>{{ book.title }}</strong>
            </p>
            <p class="desc">
              {{ book.description }}
              <br>
              <a :href="book.link" v-if="book.link">Buy on Amazon</a>
            </p>
          </div>
        </div>
        <p v-else>Loadings...</p>

        <div class="callout">
          <p>
            <strong>Got more resources?</strong>
            Resources on this page come from a public Google Spreadsheet, feel free to add or edit!
          </p>
          <p>
            <a :href="workbookEditURL" class="button">View Spreadsheet</a>
          </p>
        </div>

        <h2 id="websites">ðŸ’» Websites</h2>
        <ul class="websites" v-if="websites">
          <li class="site"
              v-for="website in websites"
              v-bind:style="{ listStyleImage: 'url(' + website.icon + ')' }">
            <p>
              <a :href="website.link" target="_blank">{{ prettyLink( website.link ) }}</a>
              <br>
              {{ website.description }}
              <br>
              <small v-if="website.referralLink">[<a :href="website.referralLink">Referral Link</a>]</small>
            </p>
          </li>
        </ul>
        <p v-else>Loadings...</p>

        <h2 id="promos">ðŸ’¸ Promo Codes</h2>
        <ul class="promos" v-if="promos">
          <li class="promo" v-for="promo in promos">
            <h3 class="title">
              <a :href="promo.link" target="_blank">{{ promo.name }}</a>
            </h3>
            <p class="promocode">
              <input type="text" readonly onclick="select()" :value="promo.code">
            </p>
            <p>
              {{ promo.description }}
            </p>
          </li>
        </ul>
        <p v-else>Loadings...</p>

        <h2 id="tools">ðŸ›  Tools</h2>
        <p class="filter">
          <label for="filter">Filter Tools</label>
          <input type="text" name="filter" value="" v-model="search">
        </p>
        <ul class="tools" v-if="tools">
          <li class="site"
              v-for="tool in tools"
              v-bind:style="{ listStyleImage: 'url(' + tool.icon + ')' }"
              v-if="tool.link"
              v-show="tool.filtered()">
            <p>
              <a :href="tool.link" target="_blank"><strong>{{ tool.name }}</strong></a>
              â€“
              {{ tool.description }}
              <br>
              <small v-if="tool.referralLink">[<a :href="tool.referralLink">
                <template v-if="tool.referralText">{{ tool.referralText }}</template>
                <template v-else>Referral Link</template>
              </a>]</small>
            </p>
            <div class="tags" v-if="tool.tags">
              <span class="tag" v-for="tag in tool.tags">{{ tag }}</span>
            </div>
          </li>
        </ul>
        <p v-else>Loadings...</p>

      </div>
    </div>

    <section id="mailing">
      <h2>ðŸ’Œ Join our mailling list</h2>
      <p>We'll send you the low down on upcoming events! Feel free to add more info about what kind of work you do so we can invite you to industry specific events.</p>
      <p><a href="https://us19.campaign-archive.com/home/?u=97afb037a144713094675ad46&id=dcfadf78b1" title="View previous campaigns">View previous campaigns.</a></p>
      <div class="mail-signup">
        <!-- Begin Mailchimp Signup Form -->
        <div id="mc_embed_signup">
        <form action="https://facebook.us19.list-manage.com/subscribe/post?u=97afb037a144713094675ad46&amp;id=dcfadf78b1" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
            <p class="indicates-required grid-full"><span class="asterisk">*</span> <small>indicates required</small></p>
            <div id="mc_embed_signup_scroll" class="form-body">

        <div class="mc-field-group grid-full">
        	<label for="mce-EMAIL">Email Address  <span class="asterisk">*</span></label>
        	<input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL">
        </div>

        <div class="grid-full">
          <input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"> <small>Or fill out more info...</small>
        </div>

        <div class="mc-field-group grid-half">
        	<label for="mce-FNAME">First Name </label>
        	<input type="text" value="" name="FNAME" class="" id="mce-FNAME">
        </div>

        <div class="mc-field-group grid-half">
        	<label for="mce-LNAME">Last Name </label>
        	<input type="text" value="" name="LNAME" class="" id="mce-LNAME">
        </div>

        <div class="mc-field-group size1of2 grid-half">
        	<label for="mce-PHONE">Phone Number </label>
        	<input type="text" name="PHONE" class="" value="" id="mce-PHONE">
        </div>

        <div class="mc-field-group size1of2 grid-half">
        	<label for="mce-BIRTHDAY-month">Birthday </label>
        	<div class="datefield">
        		<span class="subfield monthfield"><input class="birthday " type="text" pattern="[0-9]*" value="" placeholder="MM" size="3" maxlength="2" name="BIRTHDAY[month]" id="mce-BIRTHDAY-month"></span> /
        		<span class="subfield dayfield"><input class="birthday " type="text" pattern="[0-9]*" value="" placeholder="DD" size="3" maxlength="2" name="BIRTHDAY[day]" id="mce-BIRTHDAY-day"></span>
        		<span class="small-meta nowrap">( mm / dd )</span>
        	</div>
        </div>

        <div class="mc-field-group input-group grid-half">
            <strong>What are you interested in? </strong>
            <ul><li><input type="checkbox" value="1" name="group[895][1]" id="mce-group[895]-895-0"><label for="mce-group[895]-895-0">Shared Gigs</label></li>
        <li><input type="checkbox" value="2" name="group[895][2]" id="mce-group[895]-895-1"><label for="mce-group[895]-895-1">Shared resources &amp; equipment</label></li>
        <li><input type="checkbox" value="4" name="group[895][4]" id="mce-group[895]-895-2"><label for="mce-group[895]-895-2">Community Building</label></li>
        <li><input type="checkbox" value="8" name="group[895][8]" id="mce-group[895]-895-3"><label for="mce-group[895]-895-3">Freelancer Policy</label></li>
        </ul>
        </div>
        <div class="mc-field-group input-group grid-half">
            <strong>What kind of freelance work do you do? </strong>
            <ul>
              <li><input type="checkbox" value="16" name="group[899][16]" id="mce-group[899]-899-0"><label for="mce-group[899]-899-0">Photography</label></li>
              <li><input type="checkbox" value="32" name="group[899][32]" id="mce-group[899]-899-1"><label for="mce-group[899]-899-1">Design</label></li>
              <li><input type="checkbox" value="64" name="group[899][64]" id="mce-group[899]-899-2"><label for="mce-group[899]-899-2">Video</label></li>
              <li><input type="checkbox" value="128" name="group[899][128]" id="mce-group[899]-899-3"><label for="mce-group[899]-899-3">Social Media</label></li>
              <li><input type="checkbox" value="256" name="group[899][256]" id="mce-group[899]-899-4"><label for="mce-group[899]-899-4">Copywriting</label></li>
              <li><input type="checkbox" value="512" name="group[899][512]" id="mce-group[899]-899-5"><label for="mce-group[899]-899-5">Consulting</label></li>
              <li><input type="checkbox" value="1024" name="group[899][1024]" id="mce-group[899]-899-6"><label for="mce-group[899]-899-6">Data</label></li>
              <li><input type="checkbox" value="2048" name="group[899][2048]" id="mce-group[899]-899-7"><label for="mce-group[899]-899-7">Marketing/PR</label></li>
              <li><input type="checkbox" value="4096" name="group[899][4096]" id="mce-group[899]-899-8"><label for="mce-group[899]-899-8">Web Design/Development</label></li>
              <li><input type="checkbox" value="8192" name="group[899][8192]" id="mce-group[899]-899-9"><label for="mce-group[899]-899-9">Accounting/Bookkeeping</label></li>
              <li><input type="checkbox" value="16384" name="group[899][16384]" id="mce-group[899]-899-10"><label for="mce-group[899]-899-10">Other</label></li>
            </ul>
          </div>

        	<div id="mce-responses" class="clear grid-full">
        		<div class="response" id="mce-error-response" style="display:none"></div>
        		<div class="response" id="mce-success-response" style="display:none"></div>
            <input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button">
        	</div>

          <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
            <div style="position: absolute; left: -5000px;" aria-hidden="true">
              <input type="text" name="b_97afb037a144713094675ad46_dcfadf78b1" tabindex="-1" value="">
            </div>
            </div>
        </form>
        </div>
        <script type='text/javascript' src='//s3.amazonaws.com/downloads.mailchimp.com/js/mc-validate.js'></script><script type='text/javascript'>(function($) {window.fnames = new Array(); window.ftypes = new Array();fnames[0]='EMAIL';ftypes[0]='email';fnames[1]='FNAME';ftypes[1]='text';fnames[2]='LNAME';ftypes[2]='text';fnames[3]='ADDRESS';ftypes[3]='address';fnames[4]='PHONE';ftypes[4]='phone';fnames[5]='BIRTHDAY';ftypes[5]='birthday';}(jQuery));var $mcj = jQuery.noConflict(true);</script>
        <!--End mc_embed_signup-->
      </div>
    </section>

    <section id="contact">
      <h1>ðŸ‘‹ Get in touch!</h1>
      <p class="lead">We are real people just like you, feel free to reach out.</p>
      <p class="lead"><a href="mailto:hello@denverfreelancing.com" class="button">Email us</a></p>
      <p>hello@denverfreelancing.com</p>
    </section>

    <script>

    "use strict"

    var app = new Vue({
      el: "#main",
      data: {
        // workbook information about the target spreadsheet
        workbook: {
          // spreadsheet ID
          id: "123dFQ4bZVXNtrmD23_xZCVNJd1_MAvdVY_yISiJcBYY",
          // The SheetID for the workbook's sheets
          // See http://damolab.blogspot.com/2011/03/od6-and-finding-other-worksheet-ids.html
          // This can be a string OR the numbered position of the tab on the
          // workbook starting with 1 as the left most tab... yeah it's crazy
          sheets: {
            websites: 'ozh0xpx',
            books: 'od6',
            tools: 'o3lgqx5',
            promos: 'o1neunz'
          }
        },
        search: '',
        filter: [],
        spreadsheet: {},
        cacheLifeTime: 1*60*60*1000, //hours*60*60*1000
      },

      /**
       * On creation get data
       */
      created: function () {
        this.getData();
      },

      methods: {
        /**
         * for each workbook.sheets get data
         */
        getData: function () {
          for ( var i in this.workbook.sheets ) {
            var sheetID = this.workbook.sheets[i];
            if ( ! this.getCache( sheetID )) {
              this.fetchData( this.workbook.id, sheetID );
            }
          }
        },
        /**
         * Capture data from spreadsheet
         * @param  {string} id    The workbook id
         * @param  {int} sheetID the sheetID or 1 indexed position of the sheet's tab
         * @return {[type]}    sends response to setData and putCache
         * @TODO error handling
         */
        fetchData: function ( id, sheetID ) {
          var xhr = new XMLHttpRequest(),
              self = this,
              url = 'https://spreadsheets.google.com/feeds/list/' + id +  '/' + sheetID + '/public/values?alt=json';
          xhr.open('GET', url )
          xhr.onload = function() {
            console.log('data loaded from xhr: ', sheetID);
            self.setData( xhr.responseText, sheetID );
            self.putCache( xhr.responseText, sheetID );
          }
          xhr.send(null)
        },
        /**
         * Sets the data into the spreadsheet object
         * @param  {string} data  The unparsed JSON string
         * @param  {string} sheetID the string reference for the workbook sheet
         */
        setData: function ( data, sheetID) {
          this.$set(this.spreadsheet, sheetID, JSON.parse( data ))
        },
        /**
         * Puts data in the localStorage
         * @param  {string} data  unparsed JSON string of data
         * @param  {string} sheetID the string reference for the workbook sheet
         */
        putCache: function ( data, sheetID ) {
          window.localStorage.setItem( sheetID , data );
          console.log('data cached');
        },
        /**
         * grabs only fresh data from the localStorage
         * @param  {string} sheetID the string reference for the workbook sheet
         * @return {bool} If data is pulled from cache returns true otherwise false
         */
        getCache: function ( sheetID ) {
          if ( this.cacheIsFresh() && window.localStorage.getItem( sheetID )  ) {
            this.setData( window.localStorage.getItem( sheetID ), sheetID )
            console.log('data loaded from cache:', sheetID);
            return true;
          }

          return false;

        },
        /**
         * Tests if the cache is fresh and resets the timer if not
         * @return {bool} if the cacheLifeTime is expired return false
         */
        cacheIsFresh: function () {
          var now = new Date().getTime();
          var setupTime = localStorage.getItem('setupTime');
          if (setupTime == null) {
              localStorage.setItem('setupTime', now);
              return false; // cache is NOT fresh
          } else {
              if(now - setupTime > this.cacheLifeTime) {
                  localStorage.clear()
                  localStorage.setItem('setupTime', now);
                  console.log('cache reset');
                  return false; // cache is NOT fresh
              }
              return true; // cache is fresh
          }
        },
        /**
         * Builds a src url to capture favion for a given URL
         * @param  {string} url a full URL for website
         * @return {string}     a url that will point to the favicon of submitted url
         */
        iconSrc: function ( url ) {
          return 'https://plus.google.com/_/favicon?domain=' + url;
        },
        /**
         * strips the http and www from a url
         * @param  {string} url a full URL for website
         * @return {string}     a url without the http and www
         * @TODO gracefull fail if url is null
         */
        stripHTTP: function ( url ) {
          var regex = new RegExp('(https?://(?:www.)?)','gi');
          return url.replace( regex, '' )
        },
        /**
         * Removes the trailing slash from a string
         * @param  {string} str string ready to have it's slash removed
         * @return {return}     string, now without a slash
         * @TODO gracefull fail if str is null
         */
        stripSlash: function ( str ) {
          return str.replace(/\/$/, "");
        },
        /**
         * Makes a URL pretty to look at
         * @param  {string} url a website url
         * @return {string}     a now pretty to look at url
         */
        prettyLink: function ( url ) {
          return this.stripSlash( this.stripHTTP( url ) );
        },
        /**
         * Extracts the amazon ASIN from a url string
         * @param  {string} url A url linking to an amazon product
         * @return {string}     the 10 character ASIN
         * @TODO handle strings without ASIN
         */
        amazonASIN: function ( url ) {
          if ( ! url ) return null;

          var rx = new RegExp('(?:[/dp/]|$)([A-Z0-9]{10})','g');
          // var rx = new RegExp('http://www.amazon.com/([\\w-]+/)?(dp|gp/product)/(\\w+/)?(\\w{10})','g');
          var arr = rx.exec( url );
          return arr[1];
        },
        /**
         * Adds Amazon affiliate tag to the end of a string
         * @param  {string} url an Amazon product URL
         * @return {string}     an Amazon product URL with a affiliate tag
         */
        amazonAffiliateLink: function ( url ) {
          if ( ! url ) return null;

          var id = 'drewinganddoi-20';
          // removes everything from the ? to the end of string
          if ( url.lastIndexOf('?') > 0) url = url.substring(0, url.lastIndexOf('?'));

          return this.stripSlash( url ) + '/?tag=' + id;
        },
        /**
         * Generates a product image url from amazon product URL
         * @param  {string} url Amazon product URL
         * @return {string}     URL pointing to product image
         * @TODO handle malformed url gracefully
         * @TODO allow choosing image size
         */
        amazonImageSrc: function ( url ) {
          if ( ! url ) return null;

          var size = [
          'THUMBZZZ',
          'MZZZZZZZ',
          'LZZZZZZZ'
          ];

          return 'http://images.amazon.com/images/P/' + this.amazonASIN( url ) + '.01.' + size[1] + '.jpg';
        },
        /**
         * Loops through Google Spreadsheet data and returns array of objects
         * constructed from callback
         * @param  {string} sheetID the string reference for the workbook sheet
         * @param  {function} action  a function which passes row data and vue object
         * @return {array}         array of row data, false if sheetID doesn't exist
         */
        gsxRowObject: function ( sheetID, action ) {
          if ( this.spreadsheet[sheetID] === undefined ) return false;
          var out  = [],
              rows = this.spreadsheet[sheetID].feed.entry,
              self = this;

          for (var i = 0; i < rows.length; i++) {
            var rowObj = action( rows[i], self );
            rowObj.filtered = function () {
              return self.filterTest(this);
            };
            out.push( rowObj );
          }

          return out;
        },
        /**
         * Gathers Google Spreadsheet cell data for a particular column
         * @param  {object} row data row from Google Spreadsheet object
         * @param  {string} col name of spreadsheet column to fetch
         * @return {string}     returns cell data, null if cell contains no data
         */
        gsxGetCol: function ( row, col ) {
          var cell = row['gsx$' + col];
          return ( cell && cell.$t ) ? cell.$t : null ;
        },
        /**
         * Tests if data object contains search term
         * @param  {object} e the 'this' of a row object
         * @return {bool}   True if search if empty or substring is found
         *                  within, otherwise false
         */
        filterTest: function (e) {
          var search = this.search.trim().toLowerCase();

          if ( '' == search ) return true; // no search means it's filtered

          var results = [];

          for ( var key in e ) {
            if ( typeof e[key] === 'string' &&
                 e[key].toLowerCase().indexOf( search ) != -1 ) {

              results.push(e[key]);

            } else if ( typeof e[key] === 'object' &&
                        e[key] && e[key].join().toLowerCase().indexOf( search ) != -1 ) {

              results.push(e[key].join());

            }
          }

          if ( results.length == 0) return false;
          return true;
        }
      },

      computed: {
        /**
         * Generates an edit link to the Google Spreadsheet
         * @return {string} url to spreadsheet
         */
        workbookEditURL: function () {
          return 'https://docs.google.com/spreadsheets/d/' + this.workbook.id + '/edit';
        },
        /**
         * Creates a cleaned up array of row data objects
         * from the website sheets data
         * the string passed into gsxGetCol corrisponds to the column header
         * on the spreadsheet, lower case and without spaces
         * @return {array} array of objects
         */
        websites: function () {
          return this.gsxRowObject( this.workbook.sheets.websites , (r,self) => (
              {
                link: self.gsxGetCol( r, 'link'),
                referralLink: self.gsxGetCol( r, 'referrallink'),
                description: self.gsxGetCol( r, 'description'),
                icon: self.iconSrc( self.gsxGetCol( r, 'link') )
              })
            );
        },
        /**
         * Creates a cleaned up array of row data objects
         * from the books sheets data
         * the string passed into gsxGetCol corrisponds to the column header
         * on the spreadsheet, lower case and without spaces
         * @return {array} array of objects
         */
        books : function () {
          return this.gsxRowObject( this.workbook.sheets.books , function (r,self) {
            var link = self.gsxGetCol( r, 'amazonlink' );
            return {
              link: self.amazonAffiliateLink( link ),
              cover: self.amazonImageSrc( link ),
              title: self.gsxGetCol( r, 'title' ),
              description: self.gsxGetCol( r, 'description' )
            }
          });
        },
        /**
         * Creates a cleaned up array of row data objects
         * from the tools sheets data
         * the string passed into gsxGetCol corrisponds to the column header
         * on the spreadsheet, lower case and without spaces
         * @return {array} array of objects
         */
        tools: function () {
          return this.gsxRowObject( this.workbook.sheets.tools , function (r,self) {
            var tags = self.gsxGetCol( r, 'tags');
            return {
              link: self.gsxGetCol( r, 'website'),
              name: self.gsxGetCol( r, 'name'),
              description: self.gsxGetCol( r, 'description'),
              icon: self.iconSrc( self.gsxGetCol( r, 'website') ),
              // if there are tags split them into an array
              tags: (tags) ? self.gsxGetCol( r, 'tags').split(',') : false,
              referralLink: self.gsxGetCol( r, 'referrallink'),
              referralText: self.gsxGetCol( r, 'referraltext'),
            }
          });
        },
        /**
         * Creates a cleaned up array of row data objects
         * from the promos sheets data
         * the string passed into gsxGetCol corrisponds to the column header
         * on the spreadsheet, lower case and without spaces
         * @return {array} array of objects
         */
        promos: function () {
          return this.gsxRowObject( this.workbook.sheets.promos , (r,self) => (
            {
              code: self.gsxGetCol( r, 'promocode'),
              name: self.gsxGetCol( r, 'title'),
              description: self.gsxGetCol( r, 'description'),
              link: self.gsxGetCol( r, 'url'),
            })
          );
        },
      },
    });


    /**
    * @TODO is this event working???
    * Function that tracks a click on an outbound link in Analytics.
    * This function takes a valid URL string as an argument, and uses that URL string
    * as the event label. Setting the transport method to 'beacon' lets the hit be sent
    * using 'navigator.sendBeacon' in browser that support it.
    */
    var trackOutboundLink = function(url) {
       gtag('send', 'event', 'outbound', 'click', url, {
         'transport': 'beacon',
         'hitCallback': function(){ document.location = url; }
       });
    }

    app.$nextTick( function () {

      var a = document.getElementsByTagName('a');

      for (var i = 0; i < a.length; i++) {
        if ( isExternalLink( a[i] )) {
          a[i].onclick = function () {
            trackOutboundLink( this.href );
          }
        }
      }
    });

    function isExternalLink( linkObj ) {
      var host = window.location.hostname;

      return ( linkObj.hostname !== host );
    }

    </script>
  </body>
</html>
